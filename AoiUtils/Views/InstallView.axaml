<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AoiUtils.ViewModels"
             xmlns:models="using:AoiUtils.Core.Models"
             x:Class="AoiUtils.Views.InstallView"
             x:DataType="vm:InstallViewModel">
    
    <Grid RowDefinitions="Auto, Auto, *, Auto">
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="30, 30, 30, 0" Spacing="5">
            <TextBlock Text="{Binding Localizer[AppInstallerHeader]}" FontSize="28" FontWeight="SemiBold"/>
            <TextBlock Text="{Binding Localizer[AppInstallerSubHeader]}" 
                       Foreground="{DynamicResource SystemBaseMediumColor}"/>
        </StackPanel>

        <!-- Filter Bar -->
        <Border Grid.Row="1" Margin="30, 20, 30, 0">
            <TextBox Text="{Binding SearchText}" 
                     Watermark="{Binding Localizer[SearchPlaceholder]}" 
                     Classes="revealPasswordButton"
                     InnerLeftContent=" ">
                <TextBox.InnerRightContent>
                    <PathIcon Data="{StaticResource globe_regular}" Width="16" Margin="0,0,10,0" Opacity="0.5"/>
                </TextBox.InnerRightContent>
            </TextBox>
        </Border>

        <!-- App List -->
        <ScrollViewer Grid.Row="2" Margin="30, 10">
            <ItemsControl ItemsSource="{Binding FilteredApps}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:AppItem">
                        <Border Background="{DynamicResource SystemListLowColor}" 
                                CornerRadius="8" 
                                Margin="0,0,0,8" 
                                Padding="15,10">
                            <Grid ColumnDefinitions="Auto, Auto, *, Auto">
                                <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" VerticalAlignment="Center"/>
                                
                                <Border Grid.Column="1" Width="40" Height="40" 
                                        Background="{DynamicResource SystemBaseLowColor}" 
                                        CornerRadius="4" Margin="10,0" ClipToBounds="True">
                                    <Panel>
                                        <!-- Letter Icon (Lightweight & Fast) -->
                                        <TextBlock Text="{Binding Name[0]}" 
                                                   VerticalAlignment="Center" 
                                                   HorizontalAlignment="Center" 
                                                   FontWeight="Bold" 
                                                   FontSize="20"
                                                   Foreground="#0078d4"/>
                                    </Panel>
                                </Border>

                                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Description}" FontSize="12" Foreground="{DynamicResource SystemBaseMediumColor}"/>
                                </StackPanel>
                                
                                <Border Grid.Column="3" Background="#1e0078d4" CornerRadius="10" Padding="10,2" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Category}" 
                                               FontSize="10" 
                                               Foreground="#0078d4"
                                               FontWeight="Bold"/>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="3" Background="{DynamicResource SystemListLowColor}" Padding="30, 20">
            <Grid ColumnDefinitions="*, Auto, Auto">
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock Text="{Binding ProgressText}" IsVisible="{Binding IsBusy}" Foreground="#0078d4"/>
                </StackPanel>
                
                <Button Grid.Column="1" 
                        Command="{Binding UninstallSelectedCommand}"
                        IsEnabled="{Binding !IsBusy}"
                        Padding="20, 10"
                        Margin="0,0,10,0"
                        Background="#ff4444"
                        Foreground="White">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <PathIcon Data="{StaticResource trash_regular}" Width="14" Height="14"/>
                            <TextBlock Text="Uninstall"/>
                        </StackPanel>
                    </Button.Content>
                </Button>

                <Button Grid.Column="2" 
                        Content="{Binding Localizer[InstallSelected]}" 
                        Command="{Binding InstallSelectedCommand}"
                        IsEnabled="{Binding !IsBusy}"
                        Padding="30, 10"
                        Background="#0078d4"
                        Foreground="White"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
